import os
import sys
import asyncio
import json
import time

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹ã‚’è¿½åŠ ï¼ˆã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼å›é¿ï¼‰
sys.path.append(os.path.join(os.path.dirname(__file__), '..'))

from app.services.opensearch_client import opensearch_client
from dotenv import load_dotenv

# ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿
load_dotenv()

# è¬›æ¼”è¦ç´„ãƒ‡ãƒ¼ã‚¿ï¼ˆæ—¢å­˜ã¨åŒã˜ï¼‰
transcript_data = {
    "AWS-08": """# ç”ŸæˆAIã®ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿æ´»ç”¨å®Ÿè·µã‚¬ã‚¤ãƒ‰è¦ç´„

## è¬›æ¼”è€…ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¦‚è¦
- **è¬›æ¼”è€…**: AWS Japan ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆ ã‚¿ã‚«ãƒæ°
- **å°‚é–€é ˜åŸŸ**: è£½é€ æ¥­é¡§å®¢æ”¯æ´ã€Amazon Timestreamã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç³»ã‚µãƒ¼ãƒ“ã‚¹
- **ãƒ¬ãƒ™ãƒ«**: 300ï¼ˆæŠ€è¡“ãƒ¡ã‚¤ãƒ³ã€ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ»ãƒ¢ãƒ‡ãƒ«å­¦ç¿’ã¯å¯¾è±¡å¤–ï¼‰
- **ç›®æ¨™**: RAGå®Ÿè£…ã®è€ƒãˆæ–¹ãƒ»è¨­è¨ˆãƒ»å®Ÿè£…ãƒ’ãƒ³ãƒˆã®æä¾›

## å…·ä½“çš„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼šè‡ªå‹•è»Šä¿é™ºæ¤œè¨ã‚·ã‚¹ãƒ†ãƒ 

### ã‚·ãƒŠãƒªã‚ªè¨­å®š
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼**: Patï¼ˆæ–°è»Šè³¼å…¥ã€æ—§è»Šå£²å´æ¸ˆã¿ï¼‰
- **ãƒ‹ãƒ¼ã‚º**: æ–°è»Šç”¨è‡ªå‹•è»Šä¿é™ºã®æ–™é‡‘ãƒ»è£œå„Ÿå†…å®¹æ¯”è¼ƒæ¤œè¨
- **æä¾›ã‚µãƒ¼ãƒ“ã‚¹**: ç”ŸæˆAIã‚’ä½¿ã£ãŸãƒãƒ¼ãƒãƒ£ãƒ«ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆï¼ˆãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªï¼‰

### RAGãŒå¿…è¦ãªç†ç”±
- **å•é¡Œ**: å˜ç´”ãªè³ªå•ã§ã¯ä¸€èˆ¬çš„ãªå›ç­”ã—ã‹å¾—ã‚‰ã‚Œãªã„
- **è§£æ±º**: ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸå›ç­”ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¨ä¿é™ºä¼šç¤¾æƒ…å ±ãŒå¿…è¦
- **åŠ¹æœ**: è©³ç´°ãªè¦‹ç©ã‚‚ã‚Šæä¾›ãŒå¯èƒ½

## RAGã«ãŠã‘ã‚‹2ã¤ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

### 1. çŠ¶æ³ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
- **å®šç¾©**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®äººç‰©ãƒ»ç¾åœ¨çŠ¶æ³ãƒ»äº‹å®Ÿã«ã¤ã„ã¦ã®æƒ…å ±
- **ä¾‹**: Patã®é‹è»¢å±¥æ­´ã€è»Šã®ã‚¹ãƒšãƒƒã‚¯
- **ä¿å­˜å ´æ‰€**: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆæ§‹é€ åŒ–ã•ã‚Œã¦æ•´ç†æ¸ˆã¿ï¼‰

### 2. ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
- **å®šç¾©**: è³ªå•ãƒ»äº‹å®Ÿã«é–¢é€£ã™ã‚‹é¡ä¼¼æƒ…å ±ã€æ„å‘³ã‚’ä¸ãˆã‚‹æƒ…å ±
- **ä¾‹**: æ³•å¾‹ãƒ»è¦å‰‡ãƒ»ãƒ«ãƒ¼ãƒ«ã€ä¿é™ºæ–™æƒ…å ±
- **ä¿å­˜å ´æ‰€**: ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆæ„å‘³çš„é¡ä¼¼æ€§ã«åŸºã¥ãæ¤œç´¢ã®ãŸã‚ï¼‰

## æ‹¡å¼µãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®4ã¤ã®æ§‹æˆè¦ç´ 

1. **åŸºç›¤ãƒ¢ãƒ‡ãƒ«ã®æŒ‡ç¤º**ï¼ˆã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰
2. **çŠ¶æ³ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ã—ãŸäº‹å®Ÿæƒ…å ±ï¼‰
3. **ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**ï¼ˆãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã§å–å¾—ã—ãŸé–¢é€£æƒ…å ±ï¼‰
4. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•**

## RAGã®3ã¤ã®ç™ºå±•æ®µéš

### 1. Naive RAGï¼ˆåŸºæœ¬ï¼‰
- **ç‰¹å¾´**: å…¨ã¦ã®RAGã®åŸºæœ¬ã€ã‚·ãƒ³ãƒ—ãƒ«
- **é©ç”¨å ´é¢**: èª°ã«ã§ã‚‚åŒã˜ã‚ˆã†ãªå›ç­”ã§ååˆ†ãªå ´åˆ
- **èª²é¡Œ**: ãƒ‡ãƒ¼ã‚¿ã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã‚’æ‰ãˆã‚‰ã‚Œãªã„ï¼ˆä¾‹ï¼šä¿é™ºæ–™200ï½5,000ãƒ‰ãƒ«ã¨ã„ã†å¹…åºƒã„å›ç­”ï¼‰

### 2. Advanced RAG
- **ç›®çš„**: ã‚ˆã‚Šæœ€é©ãªå›ç­”ã®ãŸã‚ã®è¤‡æ•°æ¤œç´¢æ‰‹æ³•çµ„ã¿åˆã‚ã›
- **3ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**:
  1. **æ¤œç´¢å‰å‡¦ç†**: è³ªå•ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã€ãƒªãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°ã€ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«
  2. **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢**: é«˜åº¦ãªæ¤œç´¢æ‰‹æ³•
  3. **æ¤œç´¢å¾Œå‡¦ç†**: ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€ãƒªãƒ©ãƒ³ã‚­ãƒ³ã‚°ã€è¦ç´„

#### Advanced RAGã®æ¤œç´¢æ‰‹æ³•

##### ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢
- **çµ„ã¿åˆã‚ã›**: ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ + å…¨æ–‡æ¤œç´¢ + ãƒªãƒ©ãƒ³ã‚­ãƒ³ã‚°
- **ãƒ¡ãƒªãƒƒãƒˆ**: 
  - ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢: å›ºæœ‰åè©ãƒ»å°‚é–€ç”¨èªã®å–ã‚Šã“ã¼ã—è£œå®Œ
  - ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢: è¡¨ç¾ã®é•ã„ãƒ»è¨€ã„æ›ãˆã¸ã®å¯¾å¿œ
- **ç”¨é€”**: ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆãªã©ã€æ­£ç¢ºãªäº‹å®Ÿæƒ…å ±ã¨æ„å‘³çš„è¿‘ä¼¼æƒ…å ±ã®çµ„ã¿åˆã‚ã›

##### ã‚°ãƒ©ãƒ•RAG
- **ç‰¹å¾´**: è¤‡é›‘ãªæƒ…å ±ã®é–¢é€£æ€§ãŒå¿…è¦ãªå ´åˆã«åŠ¹æœã‚’ç™ºæ®
- **AWSå¯¾å¿œ**: Amazon Neptune Analytics

##### è‡ªç„¶è¨€èªâ†’SQLå¤‰æ›
- **ç”¨é€”**: æ˜ç¢ºã«SQLåŒ–ã§ãã‚‹è³ªå•
- **ãƒ¡ãƒªãƒƒãƒˆ**: å…¨ãƒ‡ãƒ¼ã‚¿ã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–ãŒä¸è¦ã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ´»ç”¨

### 3. Modular RAG
- **ç›®çš„**: è¤‡æ•°ã®ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ãƒ»å‡¦ç†ã®æœ€é©ãªçµ„ã¿åˆã‚ã›ã¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®è‡ªå‹•åŒ–
- **å®Ÿè£…**: AWS Bedrock Agentã‚’æ´»ç”¨ã—ãŸã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- **åŠ¹æœ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‹ã‚‰å¯¾å¿œå†…å®¹ã‚’è‡ªå‹•åˆ¤æ–­ã—ã€é †ç•ªãƒ»ã‚„ã‚Šå–ã‚Šã‚’æœ€é©åŒ–

## ãƒ‡ãƒ¼ã‚¿åŸºç›¤æ§‹ç¯‰

### ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®åˆ†é¡
1. **æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®å®šç¾©ã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒãƒ‡ãƒ¼ã‚¿
2. **åŠæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿**: JSONã€XMLï¼ˆæ™‚é–“ã¨ã¨ã‚‚ã«ã‚¹ã‚­ãƒ¼ãƒãŒå¤‰åŒ–ï¼‰
3. **éæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿**: æ–‡æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ç”»åƒï¼ˆåŸ‹ã‚è¾¼ã¿ãƒ¢ãƒ‡ãƒ«ã§ãƒ™ã‚¯ãƒˆãƒ«åŒ–ãŒå¿…è¦ï¼‰

### ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°æ‰‹æ³•

#### 1. å›ºå®šé•·ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°
- **ãƒ¡ãƒªãƒƒãƒˆ**: å®Ÿè£…ãŒç°¡å˜
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**: æ„å‘³ã®åŒºåˆ‡ã‚Šã‚’ç„¡è¦–ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤±ã†å¯èƒ½æ€§

#### 2. ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
- **ãƒ¡ãƒªãƒƒãƒˆ**: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã—ã£ã‹ã‚Šæ‰ãˆã‚‹
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**: å…¨ã¦æ‰‹å‹•å®šç¾©ãŒå¿…è¦ã§å¤§å¤‰

#### 3. éšå±¤ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°ï¼ˆHierarchical Chunkingï¼‰
- **ç‰¹å¾´**: ã‚°ãƒ«ãƒ¼ãƒ—ãƒ»éšå±¤ã”ã¨ã«åˆ†å‰²
- **AWSå®Ÿè£…**: Bedrock Knowledge Baseã®è¦ªãƒãƒ£ãƒ³ã‚¯ãƒ»å­ãƒãƒ£ãƒ³ã‚¯æ©Ÿèƒ½
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**: ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ãŒå¿…è¦

#### 4. ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°
- **ç‰¹å¾´**: LLMã‚’ä½¿ç”¨ã—ãŸæ„å‘³ã‚’è€ƒæ…®ã—ãŸåˆ†å‰²
- **ãƒ¡ãƒªãƒƒãƒˆ**: æœ€ã‚‚è‰¯ã„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—ã®å¯èƒ½æ€§
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**: æ™‚é–“ãƒ»ãƒªã‚½ãƒ¼ã‚¹ã‚³ã‚¹ãƒˆãŒé«˜ã„

### ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºã®é¸æŠ
- **å°ã•ãªãƒãƒ£ãƒ³ã‚¯**: ã‚·ãƒ³ãƒ—ãƒ«ãªè³ªå•å¯¾å¿œã€ãƒã‚¤ãƒ³ãƒˆå–å¾—ã«é©ã—ã¦ã„ã‚‹
- **å¤§ããªãƒãƒ£ãƒ³ã‚¯**: æ·±ã„æ–‡æ›¸è§£é‡ˆãƒ»è¦ç´„ãŒå¿…è¦ãªå ´åˆã€å…¨ä½“æ–‡è„ˆæŠŠæ¡ãŒé‡è¦

### ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é¸æŠåŸºæº–
- **æœ€å„ªå…ˆ**: é¦´æŸ“ã¿ãŒã‚ã‚Šä½¿ã„ã‚„ã™ã„ã‚‚ã®
- **ç†ç”±**: å®Ÿè£…ã®æ…£ã‚ŒãŒæœ€ã‚‚é‡è¦
- **AWSæä¾›**: å„ç¨®ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢å¯¾å¿œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

## ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ»ã‚¬ãƒãƒŠãƒ³ã‚¹

### ãƒ‡ãƒ¼ã‚¿åˆ†æ•£ã«ã‚ˆã‚‹èª²é¡Œ
- **ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ãƒ­åŒ–**: å„æ‰€ã«æ•£åœ¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿
- **ãƒ‡ãƒ¼ã‚¿ãƒªãƒãƒ¼ã‚¸**: ãƒ‡ãƒ¼ã‚¿ã®å‡ºæ‰€è¿½è·¡
- **ãƒ‡ãƒ¼ã‚¿å“è³ª**: æ­£ç¢ºæ€§ã®æ‹…ä¿
- **ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«**: é©åˆ‡ãªæ¨©é™ç®¡ç†

### ãƒ‡ãƒ¼ã‚¿åŸºç›¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### 1. ç–çµåˆè¨­è¨ˆ
- ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã¨å‡¦ç†ã‚’åˆ†é›¢
- éƒ¨åˆ†å¤‰æ›´ãƒ»å†åˆ©ç”¨ã®å®¹æ˜“ã•

#### 2. é©åˆ‡ãªãƒ„ãƒ¼ãƒ«é¸æŠ
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ â†’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ã‚µãƒ¼ãƒ“ã‚¹
- ãƒãƒƒãƒâ†’ãƒ‡ãƒ¼ã‚¿ã‚¦ã‚§ã‚¢ãƒã‚¦ã‚¹

#### 3. ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹æ´»ç”¨
- ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ç®¡ç†ãƒ»é‹ç”¨ã‚’AWSã«å§”ä»»
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºãƒ»UXå‘ä¸Šã«é›†ä¸­

#### 4. ãƒ­ã‚°ä¸­å¿ƒãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚¶ã‚¤ãƒ³
- å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒ­ã‚°ã¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯ã«ä¿å­˜
- ãƒã‚°ãƒ»ä¸å…·åˆæ™‚ã®å¾©æ—§å¯èƒ½æ€§ç¢ºä¿

#### 5. ã‚³ã‚¹ãƒˆæ„è­˜
- è¨­è¨ˆæ®µéšã§ã®ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š
- ç„¡é§„ã®ç¢ºèªã¨æœ€é©åŒ–

## æ¨å¥¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹æˆ

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¦ä»¶**: ãƒŸãƒªç§’â†’RDBMS/ãƒ™ã‚¯ãƒˆãƒ«DBã€ç§’â†’ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯
- **æ§‹æˆè¦ç´ **:
  - ä¼šè©±çŠ¶æ…‹ç®¡ç†ï¼ˆDynamoDBï¼‰
  - çŠ¶æ³ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ—¢å­˜DBï¼‰
  - ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆãƒ™ã‚¯ãƒˆãƒ«DBï¼‰

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆãƒ‡ãƒ¼ã‚¿åé›†ãƒ»ç®¡ç†ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯**: S3ä¸­å¿ƒã®æ§‹æˆ
- **ã‚ªãƒ¼ãƒ—ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: æ›´æ–°ã—ã‚„ã™ã„Parquetå½¢å¼
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†**: AWS Glue Data Catalog

### ãƒ‡ãƒ¼ã‚¿ã‚¬ãƒãƒŠãƒ³ã‚¹
- **ã‚«ã‚¿ãƒ­ã‚°åŒ–**: AWS LakeFormation
- **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: ç®¡ç†å´è¨±å¯ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨
- **ãƒ‡ãƒ¼ã‚¿å“è³ª**: AWS Glue Data Qualityï¼ˆSQLå®£è¨€çš„ãƒ«ãƒ¼ãƒ«ï¼‰
- **ãƒªãƒãƒ¼ã‚¸ç®¡ç†**: LakeFormationã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ç³»è­œè¿½è·¡

## ã¾ã¨ã‚ãƒ»æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### æ®µéšçš„ç™ºå±•
1. **Naive RAGã‹ã‚‰é–‹å§‹**: åŸºæœ¬æ§‹æˆã§é–‹å§‹
2. **æ®µéšçš„ç™ºå±•**: è¦ä»¶ã«å¿œã˜ã¦Advanced/Modular RAGã¸

### ãƒ‡ãƒ¼ã‚¿æ´»ç”¨ã®è€ƒãˆæ–¹
- **å…¨ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã¯ä¸è¦**: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®æ´»ç”¨
- **æœ€é©ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæä¾›ã®ãŸã‚ã®è¨­è¨ˆ
- **è‡ªå‹•åŒ–æ¨é€²**: RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å¯èƒ½ãªé™ã‚Šã®è‡ªå‹•åŒ–

### ä¾¡å€¤æä¾›ã¸ã®é›†ä¸­
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¾¡å€¤ã«ç›´çµã—ãªã„éƒ¨åˆ†ã®è‡ªå‹•åŒ–
- ã‚ˆã‚Šè‰¯ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“å®Ÿç¾ã¸ã®æ³¨åŠ›"""
}

async def find_session_by_id(session_id: str):
    """ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ¤œç´¢"""
    try:
        client = await opensearch_client.initialize()
        
        search_query = {
            "query": {
                "term": {
                    "session_id": session_id
                }
            }
        }
        
        response = client.search(index="aws_summit_sessions", body=search_query)
        
        if response['hits']['hits']:
            return response['hits']['hits'][0]
        return None
        
    except Exception as e:
        print(f"âŒ Error finding session {session_id}: {e}")
        return None

async def create_enhanced_session_document(session_id: str, transcript_content: str):
    """æ–°ã—ã„æ‹¡å¼µã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆ"""
    try:
        print(f"ğŸ” Searching for original session: {session_id}")
        
        # å…ƒã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ¤œç´¢
        hit = await find_session_by_id(session_id)
        
        if hit:
            original_doc = hit['_source']
            print(f"âœ… Found original session: {original_doc['title']}")
            
            # æ‹¡å¼µãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆ
            enhanced_doc = original_doc.copy()
            enhanced_doc['transcript_summary'] = transcript_content
            enhanced_doc['has_detailed_content'] = True
            enhanced_doc['data_version'] = 'enhanced_v1'
            enhanced_doc['enhanced_timestamp'] = time.time()
            
            # æ–°ã—ã„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã—ã¦è¿½åŠ 
            client = await opensearch_client.initialize()
            response = client.index(
                index="aws_summit_sessions",
                body=enhanced_doc
            )
            
            new_doc_id = response['_id']
            print(f"âœ… Successfully created enhanced session document")
            print(f"ğŸ“„ New document ID: {new_doc_id}")
            print(f"ğŸ“„ Added transcript summary ({len(transcript_content)} characters)")
            print(f"ğŸ”— Original document preserved")
            
            return True
            
        else:
            print(f"âŒ Original session {session_id} not found")
            return False
            
    except Exception as e:
        print(f"âŒ Error creating enhanced session {session_id}: {e}")
        print(f"ğŸ” Error details: {type(e).__name__}: {str(e)}")
        return False

async def verify_enhanced_session(session_id: str):
    """æ‹¡å¼µã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä½œæˆã‚’ç¢ºèª"""
    try:
        client = await opensearch_client.initialize()
        
        # æ‹¡å¼µã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ¤œç´¢
        search_query = {
            "query": {
                "bool": {
                    "must": [
                        {"term": {"session_id": session_id}},
                        {"term": {"has_detailed_content": True}}
                    ]
                }
            }
        }
        
        response = client.search(index="aws_summit_sessions", body=search_query)
        
        if response['hits']['hits']:
            enhanced_doc = response['hits']['hits'][0]['_source']
            summary_length = len(enhanced_doc.get('transcript_summary', ''))
            has_detailed = enhanced_doc.get('has_detailed_content', False)
            
            print(f"âœ… Enhanced session verification successful for {session_id}")
            print(f"   - transcript_summary: {summary_length} characters")
            print(f"   - has_detailed_content: {has_detailed}")
            print(f"   - data_version: {enhanced_doc.get('data_version', 'unknown')}")
            return True
        else:
            print(f"âŒ Enhanced session verification failed for {session_id}")
            return False
            
    except Exception as e:
        print(f"âŒ Error verifying enhanced session {session_id}: {e}")
        return False

async def main():
    """ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œé–¢æ•°ï¼ˆä¿®æ­£ç‰ˆï¼‰"""
    print("ğŸš€ Starting transcript data integration (Enhanced Version)...")
    print("=" * 60)
    
    success_count = 0
    total_count = len(transcript_data)
    
    # å„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è¦ç´„ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥
    for session_id, transcript_content in transcript_data.items():
        print(f"\nğŸ“‹ Processing session: {session_id}")
        print("-" * 40)
        
        # æ‹¡å¼µãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ
        if await create_enhanced_session_document(session_id, transcript_content):
            # ä½œæˆç¢ºèª
            if await verify_enhanced_session(session_id):
                success_count += 1
                print(f"ğŸ‰ Session {session_id} enhancement completed!")
            else:
                print(f"âš ï¸ Session {session_id} enhancement verification failed")
        else:
            print(f"ğŸ’¥ Session {session_id} enhancement failed")
    
    print("\n" + "=" * 60)
    print(f"ğŸ“Š Enhancement Summary:")
    print(f"   - Total sessions: {total_count}")
    print(f"   - Successful: {success_count}")
    print(f"   - Failed: {total_count - success_count}")
    
    if success_count == total_count:
        print("ğŸ‰ All transcript data successfully integrated!")
        print("ğŸ“‹ Note: Original sessions preserved, enhanced versions created")
    else:
        print("âš ï¸ Some enhancements failed. Please check the logs above.")

if __name__ == "__main__":
    asyncio.run(main())
